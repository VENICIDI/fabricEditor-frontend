# Fabric.js 画布编辑器 MVP 测试用例（均已自测验证通过）

## 0. 说明

本文档为**手工测试/验收测试**用例集合，面向 `editor.html` 的 MVP 功能。

建议执行顺序：

- 先跑“冒烟测试”确保页面与基础交互可用
- 再覆盖“对象创建/编辑/图层/导入导出/绘制/橡皮擦”
- 最后执行“Undo/Redo 回放保护”和“异常场景”

## 1. 测试环境与前置条件

- **浏览器**：Chrome / Edge / Safari（至少覆盖一个 Chromium + Safari）
- **启动方式**：`node server.js` 后访问 `http://localhost:8080`
- **网络**：需要能加载 Fabric CDN（否则会提示 `Fabric.js 未加载：请确保网络通畅`）

## 2. 冒烟测试（必须通过）

### TC-SMOKE-001 页面可正常打开并显示编辑器布局

- **前置条件**
  - 已启动静态服务器
- **步骤**
  - 打开 `http://localhost:8080`
- **期望结果**
  - 页面加载成功，无白屏
  - 可看到：左侧工具栏、顶部工具栏、画布区域、右侧“图层/属性”面板

### TC-SMOKE-002 Fabric CDN 加载成功

- **步骤**
  - 打开页面
- **期望结果**
  - 不弹出 `Fabric.js 未加载：请确保网络通畅`
  - 可正常创建并操作对象（后续用例依赖）

## 3. 对象创建

### TC-OBJ-001 创建矩形

- **步骤**
  - 点击左侧“形状”按钮，选择“矩形”
- **期望结果**
  - 画布上出现一个矩形
  - 新对象处于选中状态（有控制点）
  - 右侧“属性”面板显示对象类型与 id（短 id）
  - 右侧“图层”面板出现对应图层项

### TC-OBJ-002 创建圆形

- **步骤**
  - 点击左侧“形状”按钮，选择“圆形”
- **期望结果**
  - 画布上出现一个圆形
  - 行为与 TC-OBJ-001 一致

### TC-OBJ-003 创建文本（IText）

- **步骤**
  - 点击左侧“文本”按钮
- **期望结果**
  - 画布上出现可编辑文本
  - 右侧属性面板的“文本/字号”字段可用

## 4. 选择与变换（移动/缩放/旋转）

### TC-TRANS-001 单对象选择

- **步骤**
  - 创建一个矩形
  - 点击画布空白处（取消选择）
  - 再点击矩形
- **期望结果**
  - 能正确取消/恢复选中
  - 属性面板同步显示当前选中对象信息

### TC-TRANS-002 拖拽移动对象

- **步骤**
  - 选中一个对象
  - 拖拽对象移动到明显不同的位置
- **期望结果**
  - 对象跟随鼠标移动
  - 松开鼠标后对象位置保持
  - 图层面板中该对象的坐标展示（x/y）发生变化

### TC-TRANS-003 缩放与旋转

- **步骤**
  - 选中一个对象
  - 通过控制点进行缩放
  - 通过旋转控制点旋转（如 Fabric UI 提供）
- **期望结果**
  - 缩放/旋转结果正确
  - 操作结束后画布渲染正常，无对象丢失

## 5. 属性面板（样式/透明度/文本）

### TC-STYLE-001 修改填充色 fill

- **步骤**
  - 选中矩形
  - 在右侧“填充”选择一个明显不同的颜色
- **期望结果**
  - 矩形填充色立即变化
  - 后续可被撤销/重做（见 Undo/Redo 用例）

### TC-STYLE-002 修改描边 stroke 与 strokeWidth

- **步骤**
  - 选中矩形
  - 修改“描边”颜色
  - 修改“描边宽度”为一个明显不同的数值（如 8）
- **期望结果**
  - 描边颜色/宽度生效

### TC-STYLE-003 修改透明度 opacity

- **步骤**
  - 选中对象
  - 将透明度改为 `0.2`
- **期望结果**
  - 对象变得明显半透明

### TC-TEXT-001 修改文本内容（属性面板）

- **步骤**
  - 创建文本对象并选中
  - 在“文本”输入框中输入新内容
  - 触发 change（如回车或失焦）
- **期望结果**
  - 画布文本更新为新内容

### TC-TEXT-002 修改字号 fontSize

- **步骤**
  - 选中文本对象
  - 将字号改为明显不同的值（如 64）
- **期望结果**
  - 文本字号变化

### TC-TEXT-003 双击进入编辑，退出时记录一次历史

- **步骤**
  - 双击文本进入编辑态
  - 修改内容
  - 点击空白处退出编辑态
- **期望结果**
  - 文本内容变化
  - Undo 一次可回到编辑前内容（只回退一次，不需要按很多次）

## 6. 删除、复制、粘贴

### TC-EDIT-001 删除选中对象（按钮）

- **步骤**
  - 创建矩形并选中
  - 点击顶部“删除”按钮
- **期望结果**
  - 画布对象消失
  - 图层面板对应条目消失

### TC-EDIT-002 删除选中对象（快捷键）

- **步骤**
  - 选中一个对象
  - 按 `Delete` 或 `Backspace`
- **期望结果**
  - 对象被删除

### TC-EDIT-003 复制/粘贴（按钮）

- **步骤**
  - 创建矩形并选中
  - 点击“复制”，再点击“粘贴”
- **期望结果**
  - 出现一个新对象
  - 新对象相对原对象有位移（默认偏移约 20px）
  - 新对象与原对象的 `data.id` 不同（可通过导出 JSON 验证）

### TC-EDIT-004 复制/粘贴（快捷键）

- **步骤**
  - 选中一个对象
  - `⌘/Ctrl+C`，再 `⌘/Ctrl+V`
- **期望结果**
  - 行为与 TC-EDIT-003 一致

## 7. 图层面板（Layers）

### TC-LAYER-001 点击图层项可选中对象

- **步骤**
  - 创建至少 2 个对象
  - 在右侧图层面板点击其中一个对象的图层项
- **期望结果**
  - 画布中对应对象被选中
  - 属性面板同步更新

### TC-LAYER-002 显示/隐藏

- **步骤**
  - 在图层项点击“隐/显”切换
- **期望结果**
  - 对象可见性切换
  - 再次切换可恢复

### TC-LAYER-003 锁定/解锁

- **步骤**
  - 点击图层项“锁定”
  - 尝试在画布中拖拽该对象
  - 再点击“解锁”并重试拖拽
- **期望结果**
  - 锁定时对象不可移动/不可缩放/不可旋转（或不可选中/不可事件）
  - 解锁后恢复可操作

### TC-LAYER-004 上移/下移/置顶/置底

- **步骤**
  - 创建两个相互重叠的对象（例如把第二个拖到第一个上方）
  - 对其中一个对象执行“上移/下移/置顶/置底”
- **期望结果**
  - 画布叠放顺序变化符合预期
  - Undo/Redo 可回退/恢复该顺序变化

### TC-LAYER-005 双击重命名

- **步骤**
  - 在图层面板双击标题
  - 输入新名称并确认
- **期望结果**
  - 图层标题显示新名称
  - 导出 JSON 后对象 `data.name` 存在且为该名称

## 8. 自由绘制与橡皮擦

### TC-DRAW-001 进入画笔模式并绘制路径

- **步骤**
  - 点击左侧“画笔”
  - 在画布上拖动绘制
- **期望结果**
  - 生成一条路径（path）
  - 退出绘制模式后路径仍存在
  - Undo 一次可撤销新增路径

### TC-DRAW-002 画笔参数（颜色/线宽/透明度）生效

- **步骤**
  - 打开画笔设置面板
  - 设置颜色为明显颜色、线宽为更大值、透明度为 0.3
  - 绘制一条新路径
- **期望结果**
  - 新路径颜色/粗细/透明度符合设置

### TC-ERASE-001 橡皮擦擦除对象

- **步骤**
  - 创建一个较大的矩形或导入一张图片
  - 点击左侧“橡皮擦”进入擦除
  - 在对象上擦除一段
- **期望结果**
  - 被擦除区域变透明/被移除（具体取决于 Fabric 版本与 eraser 实现）
  - `erasing:end` 后 Undo 一次可恢复擦除前状态

### TC-ERASE-002 橡皮擦一次操作仅生成一次历史（批量）

- **步骤**
  - 使用橡皮擦连续擦除（同一次按下拖动过程）
  - 松开鼠标结束
  - 执行一次 Undo
- **期望结果**
  - 一次 Undo 即可回到擦除开始前（不需要多次 Undo）

## 9. 导入/导出

### TC-IO-001 导出 JSON

- **步骤**
  - 创建多个对象（含文本/图形）
  - 点击“导出” -> “导出 JSON”
- **期望结果**
  - 弹窗中显示 JSON
  - JSON 中每个对象包含 `data.id`（以及可能的 `data.type/name`）

### TC-IO-002 导入 JSON（会清空画布并清空历史）

- **步骤**
  - 先创建几个对象
  - 打开导入 JSON 弹窗
  - 粘贴一份有效 JSON 并确认
- **期望结果**
  - 画布内容变为导入的内容
  - 导入前画布对象被清空
  - Undo/Redo 栈被清空（导入后 Undo 按钮应不可用）

### TC-IO-003 导入 JSON（非法 JSON）

- **步骤**
  - 打开导入 JSON 弹窗
  - 输入明显非法的 JSON（如 `{`）并确认
- **期望结果**
  - 弹出“导入失败”或显示解析错误信息
  - 页面不崩溃，仍可继续操作

### TC-IO-004 导出 PNG（1x/2x）

- **步骤**
  - 创建对象
  - 点击“导出 PNG（1x）”和“导出 PNG（2x）”
- **期望结果**
  - 成功下载 png 文件
  - 2x 图片分辨率明显更大

### TC-IO-005 导出 SVG

- **步骤**
  - 创建矢量对象（矩形/圆形/文本）
  - 导出 SVG
- **期望结果**
  - 成功下载 svg 文件
  - 用浏览器打开 svg 能看到内容

### TC-IO-006 导入图片

- **步骤**
  - 点击“导入” -> “导入图片”
  - 选择本地图片文件
- **期望结果**
  - 图片以 Fabric Image 形式出现在画布上
  - 可移动/缩放
  - Undo 可撤销导入

### TC-IO-007 导入 SVG

- **步骤**
  - 点击“导入” -> “导入 SVG”
  - 选择本地 svg
- **期望结果**
  - SVG 被解析并作为 group/object 出现在画布
  - Undo 可撤销导入

## 10. Undo / Redo（核心验收）

### TC-HIS-001 新建对象可撤销/重做

- **步骤**
  - 创建矩形
  - 点击“撤销”
  - 点击“重做”
- **期望结果**
  - 撤销后矩形消失
  - 重做后矩形恢复

### TC-HIS-002 删除对象可撤销/重做

- **步骤**
  - 创建两个对象
  - 删除其中一个
  - Undo
  - Redo
- **期望结果**
  - Undo 后对象恢复
  - Redo 后对象再次删除

### TC-HIS-003 属性修改可撤销/重做（style）

- **步骤**
  - 修改 fill/stroke/strokeWidth/opacity
  - Undo / Redo
- **期望结果**
  - 每次 Undo/Redo 都能回到对应属性状态

### TC-HIS-004 变换类操作只在结束时入栈

- **步骤**
  - 选中对象
  - 按住拖拽移动一段距离（连续移动）
  - 松手后立刻按一次 Undo
- **期望结果**
  - 一次 Undo 回到移动前位置
  - 不需要多次 Undo 才能回到移动前

### TC-HIS-005 合并窗口（600ms）验证（可选）

- **步骤**
  - 连续两次快速移动同一对象（间隔 < 600ms）
  - 再 Undo
- **期望结果**
  - Undo 一次能回到第一次移动前（两次移动被合并为一次历史）

### TC-HIS-006 Redo 栈清空规则

- **步骤**
  - 创建矩形
  - Undo
  - 再创建圆形（新操作）
  - 尝试 Redo
- **期望结果**
  - Redo 不应恢复“被撤销的矩形创建”（redo 栈应被清空）

### TC-HIS-007 回放保护（isReplaying）

- **步骤**
  - 连续执行多个操作（创建/移动/改色）
  - 连续 Undo 到较早状态
  - 再连续 Redo 回到最新状态
- **期望结果**
  - Undo/Redo 过程中不会产生“新的历史记录”污染栈
  - Undo/Redo 结束后按钮状态正确

## 11. 快捷键

### TC-KEY-001 基础快捷键

- **步骤**
  - `⌘/Ctrl+C`、`⌘/Ctrl+V`、`Delete/Backspace`
  - `⌘Z/Ctrl+Z`、`⌘Y/Ctrl+Y`
- **期望结果**
  - 分别触发复制、粘贴、删除、撤销、重做

### TC-KEY-002 工具切换快捷键

- **步骤**
  - 按 `V/T/E/R`
- **期望结果**
  - 分别切换到选择/文本/橡皮擦/形状菜单

### TC-KEY-003 绘制模式快捷键

- **步骤**
  - 按 `B` 切换绘制模式
  - 在绘制模式下按 `Esc`
- **期望结果**
  - `B` 能开关绘制模式
  - `Esc` 能退出绘制模式

### TC-KEY-004 输入框聚焦时快捷键不应误触

- **步骤**
  - 打开导入 JSON 弹窗
  - 在 textarea 中输入文字
  - 按 `Delete/Backspace`、`⌘Z/Ctrl+Z`
- **期望结果**
  - 不应触发画布删除/撤销（应只影响文本输入）

## 12. 异常与边界

### TC-ERR-001 Fabric CDN 失败提示

- **步骤**
  - 断网或阻止 Fabric CDN
  - 刷新页面
- **期望结果**
  - 明确提示 `Fabric.js 未加载：请确保网络通畅`

### TC-ERR-002 大量对象的基本可用性（粗略性能）

- **步骤**
  - 连续创建 50+ 个对象
  - 随机移动、修改颜色、删除
- **期望结果**
  - 页面仍可用，交互无明显卡死
  - Undo/Redo 仍能工作（历史上限生效，超出不会无限增长）

---

最后更新：2025-12-24
